<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="manifest" href="/manifest.json">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="P2P Portfolio">
    <title>P2P Lending Portfolio Tracker</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiUDJQIExlbmRpbmcgVHJhY2tlciIsInNob3J0X25hbWUiOiJQMlAgVHJhY2tlciIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjNjY3ZWVhIiwidGhlbWVfY29sb3IiOiIjNjY3ZWVhIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgMTAwIDEwMCclM0UlM0NyZWN0IGZpbGw9JyUyMzY2N2VlYScgd2lkdGg9JzEwMCcgaGVpZ2h0PScxMDAnLyUzRSUzQ3RleHQgeD0nNTAnIHk9JzY1JyBmb250LXNpemU9JzUwJyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyBmaWxsPSd3aGl0ZSclM0Xwn5KwJTNDL3RleHQlM0UlM0Mvc3ZnJTNFIiwic2l6ZXMiOiI1MTJ4NTEyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
</head>
<body>
    <div class="container">
        <header>
            <select class="currency-selector" id="currencySelector" onchange="changeCurrency(this.value)">
                <option value="EUR">EUR ‚Ç¨</option>
                <option value="USD">USD $</option>
                <option value="GBP">GBP ¬£</option>
                <option value="CHF">CHF</option>
                <option value="SEK">SEK</option>
                <option value="NOK">NOK</option>
                <option value="DKK">DKK</option>
            </select>
            <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">
                <span id="themeIcon">üåô</span>
                <span id="themeText">Night Mode</span>
            </button>
            <h1>üí∞ P2P Lending Portfolio Tracker</h1>
            <p>Track your peer-to-peer lending investments</p>
        </header>

        <div class="portfolio-summary">
            <div class="capital-display">
                <h2>Total Capital</h2>
                <div class="capital-value" id="totalInvested">‚Ç¨0.00</div>
            </div>
        </div>

        <div class="account-overview">
            <h2>Account Overview</h2>
            <div class="summary-grid">
                <div class="summary-card">
                    <h3>Earned this Month</h3>
                    <div class="value" id="earnedThisMonth">‚Ç¨0.00</div>
                </div>
                <div class="summary-card">
                    <h3>Your Yield in 2025</h3>
                    <div class="value" id="yieldThisYear">‚Ç¨0.00</div>
                </div>
                <div class="summary-card">
                    <h3>Pending Incomes</h3>
                    <div class="value" id="pendingIncomes">‚Ç¨0.00</div>
                </div>
                <div class="summary-card">
                    <h3>Average Yield</h3>
                    <div class="value" id="averageYield">0%</div>
                </div>
            </div>
        </div>

        <div class="charts-section">
            <h2>üìä Portfolio Analytics</h2>
            <div class="charts-grid">
                <div class="chart-container">
                    <h3 style="text-align:center; color: var(--text-primary); margin-bottom: 15px;">Investment by Platform</h3>
                    <canvas id="platformChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3 style="text-align:center; color: var(--text-primary); margin-bottom: 15px;">Loan Categories</h3>
                    <canvas id="categoryChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3 style="text-align:center; color: var(--text-primary); margin-bottom: 15px;">Returns Breakdown</h3>
                    <canvas id="returnsChart"></canvas>
                </div>
            </div>
        </div>

        <div class="add-platform-section">
            <div class="section-header">
                <h2>Manage Platforms</h2>
                <div class="data-buttons">
                    <button class="export-btn" onclick="exportData()">üì• Export</button>
                    <button class="import-btn" onclick="document.getElementById('importFile').click()">üì§ Import</button>
                    <button class="reset-btn" onclick="resetAllData()">üóëÔ∏è Reset All</button>
                    <input type="file" id="importFile" accept=".json" onchange="importData(event)">
                </div>
            </div>
            <div class="input-group">
                <input type="text" id="platformName" placeholder="Enter platform name (e.g., Mintos, Bondora)" style="flex: 1;">
                <button onclick="addPlatform()">Add Platform</button>
            </div>
        </div>

        <div class="platforms-grid" id="platformsGrid"></div>
        <div class="no-platforms" id="noPlatforms">Add your first P2P lending platform to get started!</div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Install Prompt -->
    <div id="installPrompt" class="install-prompt">
        <div class="install-prompt-header">
            <div class="install-prompt-icon">üì±</div>
            <div class="install-prompt-text">
                <h3>Install P2P Tracker</h3>
                <p>Add this app to your home screen for quick access!</p>
            </div>
        </div>
        <div class="install-prompt-buttons">
            <button class="dismiss-btn" onclick="dismissInstallPrompt()">Not Now</button>
            <button class="install-btn" onclick="installApp()">Install</button>
        </div>
    </div>

    <!-- Modal for managing loans -->
    <div id="loanModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Platform Name</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>

            <div class="loan-form">
                <div class="form-header">
                    <h3 id="formTitle">Add New Loan</h3>
                    <span id="editModeBadge" class="edit-mode-badge" style="display: none;">Editing Mode</span>
                </div>

                <div class="form-row">
                    <div class="form-group form-group-full">
                        <label>Description</label>
                        <input type="text" id="loanDescription" placeholder="e.g., Personal loan #123, Business loan XYZ" class="full-width">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Amount Invested</label>
                        <input type="number" id="loanAmount" placeholder="1000" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Loan Category</label>
                        <select id="loanCategory">
                            <option value="personal">Personal</option>
                            <option value="business">Business</option>
                            <option value="real_estate">Real Estate</option>
                            <option value="auto">Auto</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>First Payment Date</label>
                        <input type="date" id="firstPaymentDate">
                    </div>
                    <div class="form-group">
                        <label>Last Payment Date</label>
                        <input type="date" id="lastPaymentDate" onchange="calculatePayments()">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group form-group-full">
                        <div class="checkbox-group">
                            <input type="checkbox" id="isBulletLoan" onchange="toggleBulletLoan()">
                            <label for="isBulletLoan" style="margin: 0;">Bullet Loan (Principal repaid at maturity)</label>
                        </div>
                        <div class="info-text">Interest payments are made regularly, principal is returned on the last payment date</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group form-group-full">
                        <div class="checkbox-group">
                            <input type="checkbox" id="isFixedPrincipal" onchange="toggleFixedPrincipal()">
                            <label for="isFixedPrincipal" style="margin: 0;">Fixed Principal Payments (Principal paid gradually)</label>
                        </div>
                        <div class="info-text">Fixed principal paid each period, remaining principal + total interest in last payment</div>
                    </div>
                </div>

                <div id="fixedPrincipalOptions" class="fixed-principal-options">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Principal per Payment</label>
                            <input type="number" id="principalPerPayment" placeholder="50" step="0.01" onchange="calculateFixedPrincipal()">
                        </div>
                        <div class="form-group">
                            <label>Total Interest</label>
                            <input type="number" id="totalInterest" placeholder="240" step="0.01" onchange="calculateFixedPrincipal()">
                        </div>
                        <div class="form-group">
                            <label>Payment Frequency</label>
                            <select id="fixedPrincipalFrequency" onchange="calculateFixedPrincipal()">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly" selected>Monthly</option>
                                <option value="quarterly">Quarterly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                        </div>
                    </div>
                    <div id="fixedPrincipalInfo" class="calculated-info" style="display: none;">
                        <strong>Calculated:</strong> <span id="fixedPrincipalDisplay"></span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group form-group-full">
                        <div class="checkbox-group">
                            <input type="checkbox" id="isRepeat" onchange="toggleRepeat()">
                            <label for="isRepeat" style="margin: 0;">Repeating Payment (Fixed total payment)</label>
                        </div>
                    </div>
                </div>

                <div id="repeatOptions" class="repeat-options">
                    <div class="form-row">
                        <div class="form-group">
                            <label id="installmentLabel">Payment Amount</label>
                            <input type="number" id="paymentAmount" placeholder="50" step="0.01" onchange="calculatePayments()">
                        </div>
                        <div class="form-group">
                            <label>Payment Frequency</label>
                            <select id="paymentFrequency" onchange="calculatePayments()">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly" selected>Monthly</option>
                                <option value="quarterly">Quarterly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                        </div>
                    </div>
                    <div id="calculatedInfo" class="calculated-info" style="display: none;">
                        <strong>Calculated:</strong> <span id="paymentCountDisplay"></span>
                    </div>
                </div>

                <div style="margin-top: 15px;">
                    <button onclick="saveLoan()" id="saveLoanBtn">Add Loan</button>
                    <button onclick="cancelEdit()" id="cancelEditBtn" class="cancel-edit" style="display: none;">Cancel</button>
                </div>
            </div>

            <div class="platform-overview">
                <h3>Platform Overview</h3>
                <div class="overview-grid">
                    <div class="overview-item">
                        <h4>Total Invested</h4>
                        <div class="value" id="modalTotalInvested">‚Ç¨0.00</div>
                    </div>
                    <div class="overview-item">
                        <h4>Monthly Income</h4>
                        <div class="value" id="modalMonthlyIncome">‚Ç¨0.00</div>
                    </div>
                    <div class="overview-item">
                        <h4>Total Interest</h4>
                        <div class="value" id="modalTotalReturn">‚Ç¨0.00</div>
                    </div>
                    <div class="overview-item">
                        <h4>Net Annualised Return</h4>
                        <div class="value" id="modalROI">0%</div>
                    </div>
                    <div class="overview-item">
                        <h4>Active Loans</h4>
                        <div class="value" id="modalLoanCount">0</div>
                    </div>
                </div>
            </div>

            <div class="loans-list">
                <h3>Active Loans</h3>
                <div id="loansContainer"></div>
            </div>
        </div>
    </div>

    <!-- Payment due alerts container -->
    <div id="paymentAlerts" style="position: fixed; top: 80px; right: 20px; z-index: 2000; max-width: 350px;"></div>

    <script src="script.js"></script>
</body>
</html>
